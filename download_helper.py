import pandas as pd
import numpy as np

long_margin = dict({'SR807':0.05,'CF709':0.05,'TA709':0.05,'SR811':0.05,'CF805':0.05,'SR805':0.05,'TA805':0.05,'TA712':0.05,'CF711':0.05,'TA711':0.05,'TA710':0.05,'TA804':0.05,'CF801':0.05,'TA801':0.05,'SR803':0.05,'bu1803':0.1,'SR711':0.05,'bu1712':0.1,'a1711':0.05,'jd1804':0.08,'fu1807':0.2,'sc1807':0.05,'ag1802':0.08,'al1802':0.1,'cu1802':0.09,'hc1802':0.1,'ni1802':0.1,'pb1802':0.1,'rb1802':0.1,'sn1802':0.09,'wr1802':0.2,'zn1802':0.1,'fu1806':0.2,'ZC804':0.05,'ZC802':0.05,'T1803':0.02,'TF1803':0.012,'IF1710':0.2,'jd1808':0.08,'cu1805':0.09,'hc1805':0.1,'ni1805':0.1,'pb1805':0.1,'rb1805':0.1,'ru1805':0.1,'sn1805':0.09,'wr1805':0.2,'zn1805':0.1,'ZC805':0.05,'jd1807':0.08,'TA802':0.05,'FG802':0.05,'MA802':0.07,'SF802':0.05,'SM802':0.05,'bb1802':0.2,'fb1802':0.2,'i1802':0.05,'j1802':0.05,'jd1802':0.08,'jm1802':0.05,'l1802':0.05,'p1802':0.05,'pp1802':0.05,'v1802':0.05,'fu1803':0.2,'sc2006':0.05,'ag1808':0.08,'al1808':0.1,'au1711':0.08,'bu1802':0.1,'cu1808':0.09,'hc1808':0.1,'ni1808':0.1,'pb1808':0.1,'rb1808':0.1,'ru1808':0.1,'sn1808':0.09,'wr1808':0.2,'zn1808':0.1,'ag1804':0.08,'al1804':0.1,'bu1710':0.1,'cu1804':0.09,'hc1804':0.1,'ni1804':0.1,'pb1804':0.1,'rb1804':0.1,'ru1804':0.1,'sn1804':0.09,'wr1804':0.2,'zn1804':0.1,'IC1803':0.3,'IF1803':0.2,'IH1803':0.2,'ZC806':0.05,'sc1808':0.05,'ZC808':0.05,'CY801':0.05,'CY802':0.05,'CY803':0.05,'CY804':0.05,'CY805':0.05,'CY806':0.05,'CY807':0.05,'CY808':0.05,'ag1806':0.08,'al1806':0.1,'au1709':0.08,'bu1906':0.1,'cu1806':0.09,'hc1806':0.1,'ni1806':0.1,'pb1806':0.1,'rb1806':0.1,'ru1806':0.1,'sn1806':0.09,'wr1806':0.2,'zn1806':0.1,'ag1803':0.08,'al1803':0.1,'au1804':0.08,'bu1903':0.1,'cu1803':0.09,'hc1803':0.1,'ni1803':0.1,'pb1803':0.1,'rb1803':0.1,'ru1803':0.1,'sn1803':0.09,'wr1803':0.2,'zn1803':0.1,'IC1712':0.3,'IF1712':0.2,'IH1712':0.2,'T1709':0.02,'TF1709':0.012,'SR801':0.05,'a1801':0.05,'ag1710':0.08,'al1710':0.1,'cu1710':0.09,'hc1710':0.1,'ni1710':0.1,'pb1710':0.1,'rb1710':0.1,'ru1710':0.1,'sn1710':0.09,'wr1710':0.2,'zn1710':0.1,'FG712':0.05,'MA712':0.07,'SF712':0.05,'SM712':0.05,'bb1712':0.2,'fb1712':0.2,'i1712':0.05,'j1712':0.05,'jd1712':0.08,'jm1712':0.05,'l1712':0.05,'m1712':0.05,'p1712':0.05,'pp1712':0.05,'v1712':0.05,'y1712':0.05,'ag1712':0.08,'al1712':0.1,'bu1812':0.1,'cu1712':0.09,'hc1712':0.1,'ni1712':0.1,'pb1712':0.1,'rb1712':0.1,'sn1712':0.09,'wr1712':0.2,'zn1712':0.1,'ag1711':0.08,'al1711':0.1,'au1712':0.08,'cu1711':0.09,'hc1711':0.1,'ni1711':0.1,'pb1711':0.1,'rb1711':0.1,'ru1711':0.1,'sn1711':0.09,'wr1711':0.2,'zn1711':0.1,'fu1711':0.2,'a1803':0.05,'b1709':0.05,'bb1709':0.2,'c1709':0.05,'cs1709':0.05,'fb1709':0.2,'i1709':0.05,'j1709':0.05,'jd1709':0.08,'jm1709':0.05,'l1709':0.05,'m1709':0.05,'p1709':0.05,'pp1709':0.05,'v1709':0.05,'y1709':0.05,'FG709':0.05,'JR709':0.05,'LR709':0.05,'MA709':0.07,'OI709':0.05,'PM709':0.05,'RI709':0.05,'RM709':0.05,'RS709':0.05,'bu1709':0.1,'ZC801':0.05,'IC1709':0.3,'IF1709':0.2,'IH1709':0.2,'ag1709':0.08,'al1709':0.1,'au1710':0.08,'bu1809':0.1,'cu1709':0.09,'hc1709':0.1,'ni1709':0.1,'pb1708':0.1,'pb1709':0.1,'rb1709':0.1,'ru1709':0.1,'sn1709':0.09,'wr1709':0.2,'zn1709':0.1,'SF709':0.05,'SM709':0.05,'WH709':0.05,'bb1710':0.2,'fb1710':0.2,'jd1803':0.08,'fu1804':0.2,'sc1710':0.05,'sc1711':0.05,'sc1712':0.05,'sc1801':0.05,'sc1802':0.05,'sc1803':0.05,'sc1804':0.05,'sc1806':0.05,'sc1809':0.05,'sc1812':0.05,'sc1903':0.05,'sc1906':0.05,'sc1909':0.05,'sc1912':0.05,'sc2003':0.05,'a1811':0.05,'b1805':0.05,'bb1805':0.2,'c1805':0.05,'cs1805':0.05,'fb1805':0.2,'ZC803':0.05,'T1712':0.02,'TF1712':0.012,'CF803':0.05,'SR809':0.05,'TA803':0.05,'a1809':0.05,'b1803':0.05,'bb1803':0.2,'c1803':0.05,'cs1803':0.05,'fb1803':0.2,'i1803':0.05,'j1803':0.05,'jm1803':0.05,'l1803':0.05,'m1803':0.05,'p1803':0.05,'pp1803':0.05,'v1803':0.05,'y1803':0.05,'FG803':0.05,'JR803':0.05,'LR803':0.05,'MA803':0.07,'OI803':0.05,'PM803':0.05,'RI803':0.05,'RM803':0.05,'i1710':0.05,'j1710':0.05,'jd1710':0.08,'jm1710':0.05,'l1710':0.05,'p1710':0.05,'pp1710':0.05,'v1710':0.05,'FG710':0.05,'MA710':0.07,'SF710':0.05,'SM710':0.05,'a1807':0.05,'b1801':0.05,'bb1801':0.2,'c1801':0.05,'cs1801':0.05,'fb1801':0.2,'i1801':0.05,'j1801':0.05,'jd1801':0.08,'jm1801':0.05,'l1801':0.05,'m1801':0.05,'ZC709':0.05,'ZC710':0.05,'ZC711':0.05,'ag1805':0.08,'al1805':0.1,'au1806':0.08,'bu1711':0.1,'jd1805':0.08,'i1805':0.05,'j1805':0.05,'jm1805':0.05,'l1805':0.05,'m1805':0.05,'p1805':0.05,'pp1805':0.05,'v1805':0.05,'y1805':0.05,'FG805':0.05,'JR805':0.05,'LR805':0.05,'MA805':0.07,'OI805':0.05,'PM805':0.05,'RI805':0.05,'RM805':0.05,'SF805':0.05,'SM805':0.05,'WH805':0.05,'ag1807':0.08,'SF803':0.05,'SM803':0.05,'WH803':0.05,'bb1804':0.2,'fb1804':0.2,'i1804':0.05,'j1804':0.05,'jm1804':0.05,'l1804':0.05,'p1804':0.05,'FG804':0.05,'pp1804':0.05,'v1804':0.05,'MA804':0.07,'SF804':0.05,'SM804':0.05,'sc1805':0.05,'ZC807':0.05,'SR901':0.05,'CF807':0.05,'TA807':0.05,'FG807':0.05,'JR807':0.05,'LR807':0.05,'MA807':0.07,'OI807':0.05,'PM807':0.05,'RI807':0.05,'RM807':0.05,'MA711':0.07,'OI711':0.05,'PM711':0.05,'RI711':0.05,'RM711':0.05,'RS711':0.05,'SF711':0.05,'SM711':0.05,'WH711':0.05,'a1805':0.05,'b1711':0.05,'bb1711':0.2,'c1711':0.05,'cs1711':0.05,'fb1711':0.2,'i1711':0.05,'j1711':0.05,'jd1711':0.08,'jm1711':0.05,'l1711':0.05,'m1711':0.05,'p1711':0.05,'pp1711':0.05,'v1711':0.05,'y1711':0.05,'FG711':0.05,'al1807':0.1,'au1808':0.08,'bu1801':0.1,'cu1807':0.09,'hc1807':0.1,'ni1807':0.1,'pb1807':0.1,'rb1807':0.1,'ru1807':0.1,'sn1807':0.09,'wr1807':0.2,'zn1807':0.1,'jd1806':0.08,'RS807':0.05,'SF807':0.05,'SM807':0.05,'WH807':0.05,'a1901':0.05,'b1807':0.05,'bb1807':0.2,'c1807':0.05,'cs1807':0.05,'fb1807':0.2,'i1807':0.05,'j1807':0.05,'jm1807':0.05,'l1807':0.05,'m1807':0.05,'p1807':0.05,'pp1807':0.05,'v1807':0.05,'y1807':0.05,'TA808':0.05,'bb1808':0.2,'fb1808':0.2,'i1808':0.05,'j1808':0.05,'jm1808':0.05,'l1808':0.05,'m1808':0.05,'p1808':0.05,'fu1710':0.2,'fu1712':0.2,'p1801':0.05,'pp1801':0.05,'v1801':0.05,'y1801':0.05,'FG801':0.05,'JR801':0.05,'LR801':0.05,'MA801':0.07,'OI801':0.05,'PM801':0.05,'RI801':0.05,'RM801':0.05,'SF801':0.05,'JR711':0.05,'LR711':0.05,'ZC712':0.05,'pp1808':0.05,'v1808':0.05,'y1808':0.05,'FG808':0.05,'MA808':0.07,'RM808':0.05,'RS808':0.05,'SF808':0.05,'SM808':0.05,'fu1801':0.2,'SM801':0.05,'WH801':0.05,'ag1801':0.08,'al1801':0.1,'au1802':0.08,'cu1801':0.09,'hc1801':0.1,'ni1801':0.1,'pb1801':0.1,'rb1801':0.1,'ru1801':0.1,'sn1801':0.09,'wr1801':0.2,'zn1801':0.1,'IC1710':0.3,'IH1710':0.2,'fu1805':0.2,'bu1806':0.1,'SR709':0.05,'TA806':0.05,'FG806':0.05,'MA806':0.07,'SF806':0.05,'SM806':0.05,'bb1806':0.2,'fb1806':0.2,'i1806':0.05,'j1806':0.05,'jm1806':0.05,'l1806':0.05,'p1806':0.05,'pp1806':0.05,'v1806':0.05,'fu1808':0.2,'a1709':0.05,'fu1809':0,'sc2009':0,'scefp':0})
short_margin = dict({'SR807':0.05,'CF709':0.05,'TA709':0.05,'SR811':0.05,'CF805':0.05,'SR805':0.05,'TA805':0.05,'TA712':0.05,'CF711':0.05,'TA711':0.05,'TA710':0.05,'TA804':0.05,'CF801':0.05,'TA801':0.05,'SR803':0.05,'bu1803':0.1,'SR711':0.05,'bu1712':0.1,'a1711':0.05,'jd1804':0.08,'fu1807':0.2,'sc1807':0.05,'ag1802':0.08,'al1802':0.1,'cu1802':0.09,'hc1802':0.1,'ni1802':0.1,'pb1802':0.1,'rb1802':0.1,'sn1802':0.09,'wr1802':0.2,'zn1802':0.1,'fu1806':0.2,'ZC804':0.05,'ZC802':0.05,'T1803':0.02,'TF1803':0.012,'IF1710':0.2,'jd1808':0.08,'cu1805':0.09,'hc1805':0.1,'ni1805':0.1,'pb1805':0.1,'rb1805':0.1,'ru1805':0.1,'sn1805':0.09,'wr1805':0.2,'zn1805':0.1,'ZC805':0.05,'jd1807':0.08,'TA802':0.05,'FG802':0.05,'MA802':0.07,'SF802':0.05,'SM802':0.05,'bb1802':0.2,'fb1802':0.2,'i1802':0.05,'j1802':0.05,'jd1802':0.08,'jm1802':0.05,'l1802':0.05,'p1802':0.05,'pp1802':0.05,'v1802':0.05,'fu1803':0.2,'sc2006':0.05,'ag1808':0.08,'al1808':0.1,'au1711':0.08,'bu1802':0.1,'cu1808':0.09,'hc1808':0.1,'ni1808':0.1,'pb1808':0.1,'rb1808':0.1,'ru1808':0.1,'sn1808':0.09,'wr1808':0.2,'zn1808':0.1,'ag1804':0.08,'al1804':0.1,'bu1710':0.1,'cu1804':0.09,'hc1804':0.1,'ni1804':0.1,'pb1804':0.1,'rb1804':0.1,'ru1804':0.1,'sn1804':0.09,'wr1804':0.2,'zn1804':0.1,'IC1803':0.3,'IF1803':0.2,'IH1803':0.2,'ZC806':0.05,'sc1808':0.05,'ZC808':0.05,'CY801':0.05,'CY802':0.05,'CY803':0.05,'CY804':0.05,'CY805':0.05,'CY806':0.05,'CY807':0.05,'CY808':0.05,'ag1806':0.08,'al1806':0.1,'au1709':0.08,'bu1906':0.1,'cu1806':0.09,'hc1806':0.1,'ni1806':0.1,'pb1806':0.1,'rb1806':0.1,'ru1806':0.1,'sn1806':0.09,'wr1806':0.2,'zn1806':0.1,'ag1803':0.08,'al1803':0.1,'au1804':0.08,'bu1903':0.1,'cu1803':0.09,'hc1803':0.1,'ni1803':0.1,'pb1803':0.1,'rb1803':0.1,'ru1803':0.1,'sn1803':0.09,'wr1803':0.2,'zn1803':0.1,'IC1712':0.3,'IF1712':0.2,'IH1712':0.2,'T1709':0.02,'TF1709':0.012,'SR801':0.05,'a1801':0.05,'ag1710':0.08,'al1710':0.1,'cu1710':0.09,'hc1710':0.1,'ni1710':0.1,'pb1710':0.1,'rb1710':0.1,'ru1710':0.1,'sn1710':0.09,'wr1710':0.2,'zn1710':0.1,'FG712':0.05,'MA712':0.07,'SF712':0.05,'SM712':0.05,'bb1712':0.2,'fb1712':0.2,'i1712':0.05,'j1712':0.05,'jd1712':0.08,'jm1712':0.05,'l1712':0.05,'m1712':0.05,'p1712':0.05,'pp1712':0.05,'v1712':0.05,'y1712':0.05,'ag1712':0.08,'al1712':0.1,'bu1812':0.1,'cu1712':0.09,'hc1712':0.1,'ni1712':0.1,'pb1712':0.1,'rb1712':0.1,'sn1712':0.09,'wr1712':0.2,'zn1712':0.1,'ag1711':0.08,'al1711':0.1,'au1712':0.08,'cu1711':0.09,'hc1711':0.1,'ni1711':0.1,'pb1711':0.1,'rb1711':0.1,'ru1711':0.1,'sn1711':0.09,'wr1711':0.2,'zn1711':0.1,'fu1711':0.2,'a1803':0.05,'b1709':0.05,'bb1709':0.2,'c1709':0.05,'cs1709':0.05,'fb1709':0.2,'i1709':0.05,'j1709':0.05,'jd1709':0.08,'jm1709':0.05,'l1709':0.05,'m1709':0.05,'p1709':0.05,'pp1709':0.05,'v1709':0.05,'y1709':0.05,'FG709':0.05,'JR709':0.05,'LR709':0.05,'MA709':0.07,'OI709':0.05,'PM709':0.05,'RI709':0.05,'RM709':0.05,'RS709':0.05,'bu1709':0.1,'ZC801':0.05,'IC1709':0.3,'IF1709':0.2,'IH1709':0.2,'ag1709':0.08,'al1709':0.1,'au1710':0.08,'bu1809':0.1,'cu1709':0.09,'hc1709':0.1,'ni1709':0.1,'pb1708':0.1,'pb1709':0.1,'rb1709':0.1,'ru1709':0.1,'sn1709':0.09,'wr1709':0.2,'zn1709':0.1,'SF709':0.05,'SM709':0.05,'WH709':0.05,'bb1710':0.2,'fb1710':0.2,'jd1803':0.08,'fu1804':0.2,'sc1710':0.05,'sc1711':0.05,'sc1712':0.05,'sc1801':0.05,'sc1802':0.05,'sc1803':0.05,'sc1804':0.05,'sc1806':0.05,'sc1809':0.05,'sc1812':0.05,'sc1903':0.05,'sc1906':0.05,'sc1909':0.05,'sc1912':0.05,'sc2003':0.05,'a1811':0.05,'b1805':0.05,'bb1805':0.2,'c1805':0.05,'cs1805':0.05,'fb1805':0.2,'ZC803':0.05,'T1712':0.02,'TF1712':0.012,'CF803':0.05,'SR809':0.05,'TA803':0.05,'a1809':0.05,'b1803':0.05,'bb1803':0.2,'c1803':0.05,'cs1803':0.05,'fb1803':0.2,'i1803':0.05,'j1803':0.05,'jm1803':0.05,'l1803':0.05,'m1803':0.05,'p1803':0.05,'pp1803':0.05,'v1803':0.05,'y1803':0.05,'FG803':0.05,'JR803':0.05,'LR803':0.05,'MA803':0.07,'OI803':0.05,'PM803':0.05,'RI803':0.05,'RM803':0.05,'i1710':0.05,'j1710':0.05,'jd1710':0.08,'jm1710':0.05,'l1710':0.05,'p1710':0.05,'pp1710':0.05,'v1710':0.05,'FG710':0.05,'MA710':0.07,'SF710':0.05,'SM710':0.05,'a1807':0.05,'b1801':0.05,'bb1801':0.2,'c1801':0.05,'cs1801':0.05,'fb1801':0.2,'i1801':0.05,'j1801':0.05,'jd1801':0.08,'jm1801':0.05,'l1801':0.05,'m1801':0.05,'ZC709':0.05,'ZC710':0.05,'ZC711':0.05,'ag1805':0.08,'al1805':0.1,'au1806':0.08,'bu1711':0.1,'jd1805':0.08,'i1805':0.05,'j1805':0.05,'jm1805':0.05,'l1805':0.05,'m1805':0.05,'p1805':0.05,'pp1805':0.05,'v1805':0.05,'y1805':0.05,'FG805':0.05,'JR805':0.05,'LR805':0.05,'MA805':0.07,'OI805':0.05,'PM805':0.05,'RI805':0.05,'RM805':0.05,'SF805':0.05,'SM805':0.05,'WH805':0.05,'ag1807':0.08,'SF803':0.05,'SM803':0.05,'WH803':0.05,'bb1804':0.2,'fb1804':0.2,'i1804':0.05,'j1804':0.05,'jm1804':0.05,'l1804':0.05,'p1804':0.05,'FG804':0.05,'pp1804':0.05,'v1804':0.05,'MA804':0.07,'SF804':0.05,'SM804':0.05,'sc1805':0.05,'ZC807':0.05,'SR901':0.05,'CF807':0.05,'TA807':0.05,'FG807':0.05,'JR807':0.05,'LR807':0.05,'MA807':0.07,'OI807':0.05,'PM807':0.05,'RI807':0.05,'RM807':0.05,'MA711':0.07,'OI711':0.05,'PM711':0.05,'RI711':0.05,'RM711':0.05,'RS711':0.05,'SF711':0.05,'SM711':0.05,'WH711':0.05,'a1805':0.05,'b1711':0.05,'bb1711':0.2,'c1711':0.05,'cs1711':0.05,'fb1711':0.2,'i1711':0.05,'j1711':0.05,'jd1711':0.08,'jm1711':0.05,'l1711':0.05,'m1711':0.05,'p1711':0.05,'pp1711':0.05,'v1711':0.05,'y1711':0.05,'FG711':0.05,'al1807':0.1,'au1808':0.08,'bu1801':0.1,'cu1807':0.09,'hc1807':0.1,'ni1807':0.1,'pb1807':0.1,'rb1807':0.1,'ru1807':0.1,'sn1807':0.09,'wr1807':0.2,'zn1807':0.1,'jd1806':0.08,'RS807':0.05,'SF807':0.05,'SM807':0.05,'WH807':0.05,'a1901':0.05,'b1807':0.05,'bb1807':0.2,'c1807':0.05,'cs1807':0.05,'fb1807':0.2,'i1807':0.05,'j1807':0.05,'jm1807':0.05,'l1807':0.05,'m1807':0.05,'p1807':0.05,'pp1807':0.05,'v1807':0.05,'y1807':0.05,'TA808':0.05,'bb1808':0.2,'fb1808':0.2,'i1808':0.05,'j1808':0.05,'jm1808':0.05,'l1808':0.05,'m1808':0.05,'p1808':0.05,'fu1710':0.2,'fu1712':0.2,'p1801':0.05,'pp1801':0.05,'v1801':0.05,'y1801':0.05,'FG801':0.05,'JR801':0.05,'LR801':0.05,'MA801':0.07,'OI801':0.05,'PM801':0.05,'RI801':0.05,'RM801':0.05,'SF801':0.05,'JR711':0.05,'LR711':0.05,'ZC712':0.05,'pp1808':0.05,'v1808':0.05,'y1808':0.05,'FG808':0.05,'MA808':0.07,'RM808':0.05,'RS808':0.05,'SF808':0.05,'SM808':0.05,'fu1801':0.2,'SM801':0.05,'WH801':0.05,'ag1801':0.08,'al1801':0.1,'au1802':0.08,'cu1801':0.09,'hc1801':0.1,'ni1801':0.1,'pb1801':0.1,'rb1801':0.1,'ru1801':0.1,'sn1801':0.09,'wr1801':0.2,'zn1801':0.1,'IC1710':0.3,'IH1710':0.2,'fu1805':0.2,'bu1806':0.1,'SR709':0.05,'TA806':0.05,'FG806':0.05,'MA806':0.07,'SF806':0.05,'SM806':0.05,'bb1806':0.2,'fb1806':0.2,'i1806':0.05,'j1806':0.05,'jm1806':0.05,'l1806':0.05,'p1806':0.05,'pp1806':0.05,'v1806':0.05,'fu1808':0.2,'a1709':0.05,'fu1809':0,'sc2009':0,'scefp':0})
unit = dict({'SR807':10,'CF709':5,'TA709':5,'SR811':10,'CF805':5,'SR805':10,'TA805':5,'TA712':5,'CF711':5,'TA711':5,'TA710':5,'TA804':5,'CF801':5,'TA801':5,'SR803':10,'bu1803':10,'SR711':10,'bu1712':10,'a1711':10,'jd1804':10,'fu1807':50,'sc1807':1000,'ag1802':15,'al1802':5,'cu1802':5,'hc1802':10,'ni1802':1,'pb1802':5,'rb1802':10,'sn1802':1,'wr1802':10,'zn1802':5,'fu1806':50,'ZC804':100,'ZC802':100,'T1803':10000,'TF1803':10000,'IF1710':300,'jd1808':10,'cu1805':5,'hc1805':10,'ni1805':1,'pb1805':5,'rb1805':10,'ru1805':10,'sn1805':1,'wr1805':10,'zn1805':5,'ZC805':100,'jd1807':10,'TA802':5,'FG802':20,'MA802':10,'SF802':5,'SM802':5,'bb1802':500,'fb1802':500,'i1802':100,'j1802':100,'jd1802':10,'jm1802':60,'l1802':5,'p1802':10,'pp1802':5,'v1802':5,'fu1803':50,'sc2006':1000,'ag1808':15,'al1808':5,'au1711':1000,'bu1802':10,'cu1808':5,'hc1808':10,'ni1808':1,'pb1808':5,'rb1808':10,'ru1808':10,'sn1808':1,'wr1808':10,'zn1808':5,'ag1804':15,'al1804':5,'bu1710':10,'cu1804':5,'hc1804':10,'ni1804':1,'pb1804':5,'rb1804':10,'ru1804':10,'sn1804':1,'wr1804':10,'zn1804':5,'IC1803':200,'IF1803':300,'IH1803':300,'ZC806':100,'sc1808':1000,'ZC808':100,'CY801':5,'CY802':5,'CY803':5,'CY804':5,'CY805':5,'CY806':5,'CY807':5,'CY808':5,'ag1806':15,'al1806':5,'au1709':1000,'bu1906':10,'cu1806':5,'hc1806':10,'ni1806':1,'pb1806':5,'rb1806':10,'ru1806':10,'sn1806':1,'wr1806':10,'zn1806':5,'ag1803':15,'al1803':5,'au1804':1000,'bu1903':10,'cu1803':5,'hc1803':10,'ni1803':1,'pb1803':5,'rb1803':10,'ru1803':10,'sn1803':1,'wr1803':10,'zn1803':5,'IC1712':200,'IF1712':300,'IH1712':300,'T1709':10000,'TF1709':10000,'SR801':10,'a1801':10,'ag1710':15,'al1710':5,'cu1710':5,'hc1710':10,'ni1710':1,'pb1710':5,'rb1710':10,'ru1710':10,'sn1710':1,'wr1710':10,'zn1710':5,'FG712':20,'MA712':10,'SF712':5,'SM712':5,'bb1712':500,'fb1712':500,'i1712':100,'j1712':100,'jd1712':10,'jm1712':60,'l1712':5,'m1712':10,'p1712':10,'pp1712':5,'v1712':5,'y1712':10,'ag1712':15,'al1712':5,'bu1812':10,'cu1712':5,'hc1712':10,'ni1712':1,'pb1712':5,'rb1712':10,'sn1712':1,'wr1712':10,'zn1712':5,'ag1711':15,'al1711':5,'au1712':1000,'cu1711':5,'hc1711':10,'ni1711':1,'pb1711':5,'rb1711':10,'ru1711':10,'sn1711':1,'wr1711':10,'zn1711':5,'fu1711':50,'a1803':10,'b1709':10,'bb1709':500,'c1709':10,'cs1709':10,'fb1709':500,'i1709':100,'j1709':100,'jd1709':10,'jm1709':60,'l1709':5,'m1709':10,'p1709':10,'pp1709':5,'v1709':5,'y1709':10,'FG709':20,'JR709':20,'LR709':20,'MA709':10,'OI709':10,'PM709':50,'RI709':20,'RM709':10,'RS709':10,'bu1709':10,'ZC801':100,'IC1709':200,'IF1709':300,'IH1709':300,'ag1709':15,'al1709':5,'au1710':1000,'bu1809':10,'cu1709':5,'hc1709':10,'ni1709':1,'pb1708':5,'pb1709':5,'rb1709':10,'ru1709':10,'sn1709':1,'wr1709':10,'zn1709':5,'SF709':5,'SM709':5,'WH709':20,'bb1710':500,'fb1710':500,'jd1803':10,'fu1804':50,'sc1710':1000,'sc1711':1000,'sc1712':1000,'sc1801':1000,'sc1802':1000,'sc1803':1000,'sc1804':1000,'sc1806':1000,'sc1809':1000,'sc1812':1000,'sc1903':1000,'sc1906':1000,'sc1909':1000,'sc1912':1000,'sc2003':1000,'a1811':10,'b1805':10,'bb1805':500,'c1805':10,'cs1805':10,'fb1805':500,'ZC803':100,'T1712':10000,'TF1712':10000,'CF803':5,'SR809':10,'TA803':5,'a1809':10,'b1803':10,'bb1803':500,'c1803':10,'cs1803':10,'fb1803':500,'i1803':100,'j1803':100,'jm1803':60,'l1803':5,'m1803':10,'p1803':10,'pp1803':5,'v1803':5,'y1803':10,'FG803':20,'JR803':20,'LR803':20,'MA803':10,'OI803':10,'PM803':50,'RI803':20,'RM803':10,'i1710':100,'j1710':100,'jd1710':10,'jm1710':60,'l1710':5,'p1710':10,'pp1710':5,'v1710':5,'FG710':20,'MA710':10,'SF710':5,'SM710':5,'a1807':10,'b1801':10,'bb1801':500,'c1801':10,'cs1801':10,'fb1801':500,'i1801':100,'j1801':100,'jd1801':10,'jm1801':60,'l1801':5,'m1801':10,'ZC709':100,'ZC710':100,'ZC711':100,'ag1805':15,'al1805':5,'au1806':1000,'bu1711':10,'jd1805':10,'i1805':100,'j1805':100,'jm1805':60,'l1805':5,'m1805':10,'p1805':10,'pp1805':5,'v1805':5,'y1805':10,'FG805':20,'JR805':20,'LR805':20,'MA805':10,'OI805':10,'PM805':50,'RI805':20,'RM805':10,'SF805':5,'SM805':5,'WH805':20,'ag1807':15,'SF803':5,'SM803':5,'WH803':20,'bb1804':500,'fb1804':500,'i1804':100,'j1804':100,'jm1804':60,'l1804':5,'p1804':10,'FG804':20,'pp1804':5,'v1804':5,'MA804':10,'SF804':5,'SM804':5,'sc1805':1000,'ZC807':100,'SR901':10,'CF807':5,'TA807':5,'FG807':20,'JR807':20,'LR807':20,'MA807':10,'OI807':10,'PM807':50,'RI807':20,'RM807':10,'MA711':10,'OI711':10,'PM711':50,'RI711':20,'RM711':10,'RS711':10,'SF711':5,'SM711':5,'WH711':20,'a1805':10,'b1711':10,'bb1711':500,'c1711':10,'cs1711':10,'fb1711':500,'i1711':100,'j1711':100,'jd1711':10,'jm1711':60,'l1711':5,'m1711':10,'p1711':10,'pp1711':5,'v1711':5,'y1711':10,'FG711':20,'al1807':5,'au1808':1000,'bu1801':10,'cu1807':5,'hc1807':10,'ni1807':1,'pb1807':5,'rb1807':10,'ru1807':10,'sn1807':1,'wr1807':10,'zn1807':5,'jd1806':10,'RS807':10,'SF807':5,'SM807':5,'WH807':20,'a1901':10,'b1807':10,'bb1807':500,'c1807':10,'cs1807':10,'fb1807':500,'i1807':100,'j1807':100,'jm1807':60,'l1807':5,'m1807':10,'p1807':10,'pp1807':5,'v1807':5,'y1807':10,'TA808':5,'bb1808':500,'fb1808':500,'i1808':100,'j1808':100,'jm1808':60,'l1808':5,'m1808':10,'p1808':10,'fu1710':50,'fu1712':50,'p1801':10,'pp1801':5,'v1801':5,'y1801':10,'FG801':20,'JR801':20,'LR801':20,'MA801':10,'OI801':10,'PM801':50,'RI801':20,'RM801':10,'SF801':5,'JR711':20,'LR711':20,'ZC712':100,'pp1808':5,'v1808':5,'y1808':10,'FG808':20,'MA808':10,'RM808':10,'RS808':10,'SF808':5,'SM808':5,'fu1801':50,'SM801':5,'WH801':20,'ag1801':15,'al1801':5,'au1802':1000,'cu1801':5,'hc1801':10,'ni1801':1,'pb1801':5,'rb1801':10,'ru1801':10,'sn1801':1,'wr1801':10,'zn1801':5,'IC1710':200,'IH1710':300,'fu1805':50,'bu1806':10,'SR709':10,'TA806':5,'FG806':20,'MA806':10,'SF806':5,'SM806':5,'bb1806':500,'fb1806':500,'i1806':100,'j1806':100,'jm1806':60,'l1806':5,'p1806':10,'pp1806':5,'v1806':5,'fu1808':50,'a1709':10,'fu1809':50,'sc2009':1000,'scefp':1000})


def get_data_source(filepath):
    ds = pd.read_csv(filepath)

    ds['dir'] = ds[['dir', 'action']].apply(lambda x: x['dir'] if x['action'] > 0 else -x['dir'], axis=1)
    # get the margin by dir and instrumet code
    ds['margin'] = ds[['dir', 'inst']].apply(lambda x: long_margin[x['inst']] if x['dir'] > 0 else short_margin[x['inst']], axis=1)
    # get one unit number by instrument code
    ds['unit'] = ds.inst.map(unit)
    # set the money
    ds['money'] = ds.price * ds.volume * ds.unit * ds.margin

    #sort
    ds = ds.sort_values(['date', 'time', 'inst', 'action', 'dir'],
                        ascending = [True, True, True, False, False])

    #get all instruments
    instruments = ds['inst'].unique()
    #get all trade days
    trade_days = ds['trade_day'].unique()

    # set index
    # ds.index.names = [None]
    # ds.set_index(['trade_day', 'inst', 'action', 'dir'], inplace=True)

    return ds, instruments, trade_days


def get_instrument_code(inst):
    match = re.match(r"([a-z]+)([0-9]+)", inst, re.I)
    code = ''
    code_continue = ''
    if match:
        items = match.groups()
        code = items[0]
        if len(code) == 1:
            code_continue = code + '9888'
        else:
            code_continue = code + '888'

    return code, code_continue


def get_all_instrument_code(instruments):
    inst_codes = set()
    cl = set()
    ccl = dict()
    for inst in instruments:
        code, cc = get_instrument_code(inst)
        cl.add(code)
    ic = np.array(list(cl))
    ic = ic.astype(object)
    ic.sort()
    return ic


def get_instrument_cc(code):
    if len(code) < 2:
        inst = code + '9888'
    else:
        inst = code + '888'
    return inst



filepath = ""
ds, instruments, trade_days = get_data_source(filepath)
ic = get_all_instrument_code(instruments)
icc = []
for c in ic:
    icc.append(get_instrument_cc(c))

insts = np.append(instruments, icc)

insts.sort()

insts
